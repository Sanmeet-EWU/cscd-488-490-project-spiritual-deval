@page "/greeting"
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.EntityFrameworkCore
@using SpiritualDevalApp.Data
@using SpiritualDevalApp.Models.Entities
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject AppDbContext DbContext
<PageTitle>Greeting</PageTitle>
<h3>User Details</h3>
@if (userAccount != null)
{
    <p><strong>ID:</strong> @userAccount.Id</p>
    <p><strong>Username:</strong> @userAccount.UserName</p>
    <p><strong>Role:</strong> @userAccount.Role</p>
    <p><strong>First Name:</strong> @userAccount.FirstName</p>
    <p><strong>Last Name:</strong> @userAccount.LastName</p>
    <p><strong>Email:</strong> @userAccount.Email</p>
}
else
{
    <p>Loading user details...</p>
}
@code {
    private UserAccount? userAccount;
    protected override async Task OnInitializedAsync()
    {
        // Get the authenticated user
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        if (user.Identity.IsAuthenticated)
        {
            // Retrieve the username from the ClaimsPrincipal
            var username = user.Identity.Name;
            // Fetch user details from the database
            if (!string.IsNullOrEmpty(username))
            {
                userAccount = await DbContext.UserAccounts
                    .FirstOrDefaultAsync(u => u.UserName == username);
            }
        }
    }
}